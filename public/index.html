<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nova Nataka | Event Registration</title>
    <meta name="description"
        content="Register for Nova Nataka - A fun-filled cosmic non-technical event where a stage is born among the stars.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Montserrat:wght@400;700&family=Syne:wght@400;700;800&family=Space+Grotesk:wght@400;700&family=Michroma&family=Cinzel:wght@400;700;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Syncopate:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://kit.fontawesome.com/your-font-awesome-kit.js" crossorigin="anonymous"></script>
</head>

<body>
    <!-- Preloader -->
    <div id="preloader">
        <div class="loader-content">
            <img src="logo_png.jpeg" alt="Loading Logo" class="blinking-logo">
        </div>
    </div>

    <!-- Background Slideshow -->
    <div id="bg-slideshow">
        <div class="slide active"
            style="background-image: url('https://images.unsplash.com/photo-1570126688035-1e0adadb3107?q=80&w=2000&auto=format&fit=crop');">
        </div> <!-- Black Hole -->
        <div class="slide"
            style="background-image: url('https://images.unsplash.com/photo-1614313913007-2b4ae8ce32d6?q=80&w=2000&auto=format&fit=crop');">
        </div> <!-- Wormhole/Lightseed -->
        <div class="slide"
            style="background-image: url('https://images.unsplash.com/photo-1462331940025-496dfbfc7564?q=80&w=2000&auto=format&fit=crop');">
        </div> <!-- Grand Nebula -->
        <div class="slide"
            style="background-image: url('https://images.unsplash.com/photo-1446776811953-b23d57bd21aa?q=80&w=2000&auto=format&fit=crop');">
        </div> <!-- Star Nursery -->
        <div class="slide"
            style="background-image: url('https://images.unsplash.com/photo-1465101162946-4377e57745c3?q=80&w=2000&auto=format&fit=crop');">
        </div> <!-- Deep Space Horizon -->
        <div class="bg-overlay"></div>
    </div>

    <header class="college-header">
        <div class="header-container">
            <div class="college-brand">
                <img src="msec_logo.png" alt="MSEC Logo" class="college-logo"
                    onerror="this.src='https://via.placeholder.com/100?text=Logo'">
                <div class="college-info">
                    <h1>Meenakshi Sundararajan Engineering College</h1>
                    <p class="institution-type">(An Autonomous Institution) | Managed by IIET Society</p>
                    <p class="institution-type" style="color: var(--primary-color) !important; margin-top: 5px;">
                        Department of Computer Science & Engineering</p>
                </div>
            </div>
        </div>
    </header>

    <nav class="navbar">
        <div class="logo">
            <img src="logo_png.jpeg" alt="Nova Nataka Logo" class="nav-event-logo">
            Nova Nataka<span>.</span>
        </div>
        <div class="hamburger" id="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <ul class="nav-links">
            <li><a href="#hero">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#registration">Register</a></li>
            <li><a href="#admin" onclick="fetchRegistrations()">Dashboard</a></li>
        </ul>
    </nav>

    <main>
        <!-- Hero Section -->
        <section id="hero" class="hero">
            <div class="hero-content">
                <h4 class="story-preface">The stars have whispered your name...</h4>
                <h1 class="animate-title">The Awakening of <span>Nova Nataka.</span></h1>
                <p class="animate-subtitle">A cosmic fragment has fallen to Earth, bringing with it a theater from
                    another dimension. Will you step through the veil and become part of the eternal legend?</p>
                <div class="hero-btns">
                    <a href="#about" class="btn btn-primary">Discover the Lore</a>
                    <a href="#registration" class="btn btn-outline">Enlist Your Crew</a>
                </div>
            </div>
            <div class="hero-visual">
                <div class="cosmic-orb"></div>
                <img src="logo_png.jpeg" alt="Event Logo" class="hero-event-logo">
            </div>

        </section>

        <!-- Legend/About Section -->
        <section id="about" class="about">
            <div class="story-text-container">
                <h2 class="section-title">PROLOGUE: THE STARDUST INHERITANCE</h2>
                <p class="story-paragraph">Before the first sun ignited, there was the Stage. A place where silence
                    creates music and shadows create light. Today, that stage opens its curtains once more. We call it
                    "Nova Nataka"â€”the festival of those who dare to dream in colors the world has forgotten.</p>
            </div>

            <div class="celestial-trials">
                <h3 class="story-subtitle">The Sacred Trials</h3>
                <div class="rounds-container">
                    <div class="card glass">
                        <div class="card-icon">ðŸŽ­</div>
                        <h3>TRIAL I: THE WHISPERING VOID</h3>
                        <p class="story-desc">Enter the zone of Absolute Zero. One soul is plunged into silence, while
                            the other must paint reality through movement alone. Decipher the transmission, or be lost
                            to the void.</p>
                        <span class="time-tag">Ritual Time: 5 Earth Minutes</span>
                    </div>
                    <div class="card glass">
                        <div class="card-icon">âœ¨</div>
                        <h3>TRIAL II: THE SUPERNOVA ASCENSION</h3>
                        <p class="story-desc">The ultimate combustion of talent. A spark of fate determines your path.
                            Command the stage with the fire of a thousand suns and leave your mark on the constellation
                            of time.</p>
                        <span class="time-tag">Final Objective: Immortality</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Registration Section -->
        <section id="registration" class="registration">
            <div class="registration-container glass">
                <div class="registration-header">
                    <h2 class="form-title">ENLIST YOUR CREW</h2>
                    <p class="registration-preface">The Archive of Legends is waiting. Seal your destiny among the
                        stars.</p>
                </div>

                <!-- Quick Edit Search -->
                <div class="edit-search-box">
                    <p>Already in the system? Re-access your terminal:</p>
                    <div class="search-input-group">
                        <input type="email" id="searchEmail" placeholder="Commander Email">
                        <button type="button" id="loadBtn" class="btn btn-secondary">Access Terminal</button>
                    </div>
                </div>

                <form id="registrationForm">
                    <div class="form-group">
                        <label for="teamName">Starship Identity (Team Name)</label>
                        <input type="text" id="teamName" name="teamName" placeholder="Enter your vessel's title"
                            required>
                    </div>

                    <!-- Member 1 (Lead) -->
                    <div class="member-section">
                        <h4>Chief Commander (Lead)</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <input type="text" id="m1_name" name="m1_name" placeholder="Name" required>
                            </div>
                            <div class="form-group">
                                <input type="email" id="m1_email" name="m1_email" placeholder="Email" required>
                            </div>
                            <div class="form-group">
                                <input type="tel" id="m1_phone" name="m1_phone" placeholder="Phone Number"
                                    pattern="[0-9]{10}" title="Please enter a 10-digit phone number" required>
                            </div>
                            <div class="form-group">
                                <input type="text" id="m1_college" name="m1_college" placeholder="College" required>
                            </div>
                            <div class="form-group">
                                <input type="text" id="m1_dept" name="m1_dept" placeholder="Department" required>
                            </div>
                            <div class="form-group">
                                <select id="m1_year" name="m1_year" required>
                                    <option value="" disabled selected>Select Year</option>
                                    <option value="1">1st Year</option>
                                    <option value="2">2nd Year</option>
                                    <option value="3">3rd Year</option>
                                    <option value="4">4th Year</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Member 2 -->
                    <div class="member-section">
                        <h4>Co-Pilot (Member 2 - Optional)</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <input type="text" id="m2_name" name="m2_name" placeholder="Name">
                            </div>
                            <div class="form-group">
                                <input type="tel" id="m2_phone" name="m2_phone" placeholder="Phone Number"
                                    pattern="[0-9]{10}">
                            </div>
                            <div class="form-group">
                                <input type="text" id="m2_college" name="m2_college" placeholder="College">
                            </div>
                            <div class="form-group">
                                <input type="text" id="m2_dept" name="m2_dept" placeholder="Department">
                            </div>
                            <div class="form-group">
                                <select id="m2_year" name="m2_year">
                                    <option value="" disabled selected>Select Year</option>
                                    <option value="1">1st Year</option>
                                    <option value="2">2nd Year</option>
                                    <option value="3">3rd Year</option>
                                    <option value="4">4th Year</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Member 3 -->
                    <div class="member-section">
                        <h4>Specialist (Member 3 - Optional)</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <input type="text" id="m3_name" name="m3_name" placeholder="Name">
                            </div>
                            <div class="form-group">
                                <input type="tel" id="m3_phone" name="m3_phone" placeholder="Phone Number"
                                    pattern="[0-9]{10}">
                            </div>
                            <div class="form-group">
                                <input type="text" id="m3_college" name="m3_college" placeholder="College">
                            </div>
                            <div class="form-group">
                                <input type="text" id="m3_dept" name="m3_dept" placeholder="Department">
                            </div>
                            <div class="form-group">
                                <select id="m3_year" name="m3_year">
                                    <option value="" disabled selected>Select Year</option>
                                    <option value="1">1st Year</option>
                                    <option value="2">2nd Year</option>
                                    <option value="3">3rd Year</option>
                                    <option value="4">4th Year</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <button type="submit" id="submitBtn" class="btn btn-primary submit-btn">
                        <span class="btn-text">Finalize Launch</span>
                        <div class="loader" id="loader"></div>
                    </button>
                </form>
            </div>
        </section>

        <!-- Admin Dashboard Section -->
        <section id="admin" class="admin-section">
            <div class="header-actions">
                <h2 class="section-title" style="text-align: left; margin: 0;">Live Registrations</h2>
                <button onclick="fetchRegistrations()" class="btn btn-outline" id="refreshBtn">Refresh Data</button>
            </div>

            <div class="stats-grid">
                <div class="stat-card glass">
                    <h3>Total Teams</h3>
                    <p id="totalTeams">0</p>
                </div>
                <div class="stat-card glass">
                    <h3>Total Participants</h3>
                    <p id="totalParticipants">0</p>
                </div>
            </div>

            <div class="table-container glass">
                <table id="regTable">
                    <thead>
                        <tr>
                            <th>Team ID</th>
                            <th>Team Name</th>
                            <th>Lead Name</th>
                            <th>Email</th>
                            <th>College</th>
                            <th>Status</th>
                            <th>Last Updated</th>
                        </tr>
                    </thead>
                    <tbody id="regBody">
                        <!-- Data injected here -->
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content glass">
            <div class="success-icon">âœ¨</div>
            <h2>Registration Successful!</h2>
            <p>Your team is now part of the Nova Nataka stage. A confirmation email has been sent to your Team Lead.</p>
            <button class="btn btn-primary" onclick="closeModal()">Awesome!</button>
        </div>
    </div>

    <footer>
        <img src="logo_png.jpeg" alt="Logos" class="footer-logo">
        <p style="color: var(--primary-color); font-weight: 700; letter-spacing: 1px; margin-bottom: 5px;">Conducted by
            Department of Computer Science & Engineering</p>
        <p>&copy; 2024 Nova Nataka. Born among the stars.</p>
        <p class="credits" style="font-size: 0.9rem; opacity: 0.8; margin-top: 10px;">
            MADE BY <span style="color: var(--primary-color);">GURUGOVINDH</span>,
            <span style="color: var(--primary-color);">KRISHNAPRIYA</span>,
            <span style="color: var(--primary-color);">NITIYASHREE</span> &
            <span style="color: var(--primary-color);">HARRISRAJ</span>
        </p>
        <div class="admin-link">
            <a href="/admin/download"
                style="color: var(--text-muted); font-size: 0.8rem; text-decoration: none; margin-top: 10px; display: inline-block;">Admin:
                Download registrations (.xlsx)</a>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        async function fetchRegistrations() {
            const btn = document.getElementById('refreshBtn');
            if (btn) btn.innerText = 'Refreshing...';
            try {
                const response = await fetch('/api/registrations');
                const data = await response.json();

                const body = document.getElementById('regBody');
                if (!body) return;
                body.innerHTML = '';

                let totalParticipants = 0;

                data.forEach(reg => {
                    totalParticipants += parseInt(reg['Total Members'] || 1);
                    const isUpdated = (reg['Last Updated'] && reg['Last Updated'] !== 'Never');

                    const row = `
                        <tr>
                            <td><strong>${reg['Team ID']}</strong></td>
                            <td>${reg['Team Name']}</td>
                            <td>${reg['Lead Name (M1)']}</td>
                            <td>${reg['Lead Email (M1)']}</td>
                            <td>${reg['Lead College (M1)']}</td>
                            <td>
                                <span class="status-badge ${isUpdated ? 'status-updated' : 'status-new'}">
                                    ${isUpdated ? 'Edited' : 'New'}
                                </span>
                            </td>
                            <td>${(!reg['Last Updated'] || reg['Last Updated'] === 'Never') ? reg['Registration Date'] : reg['Last Updated']}</td>
                        </tr>
                    `;
                    body.innerHTML += row;
                });

                document.getElementById('totalTeams').innerText = data.length;
                document.getElementById('totalParticipants').innerText = totalParticipants;

            } catch (err) {
                console.error('Error:', err);
            } finally {
                if (btn) btn.innerText = 'Refresh Data';
            }
        }

        // Background Slideshow Logic
        const slides = document.querySelectorAll('.slide');
        let currentSlide = 0;

        function nextSlide() {
            slides[currentSlide].classList.remove('active');
            currentSlide = (currentSlide + 1) % slides.length;
            slides[currentSlide].classList.add('active');
        }

        setInterval(nextSlide, 3000); // 3 seconds interval

        // Load data when page loads if we land on #admin
        window.addEventListener('load', () => {
            if (window.location.hash === '#admin') fetchRegistrations();
        });
    </script>
</body>

</html>